<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Modular arbitrary-order ocean-atmosphere model: MAOOAM -- Fortran implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MAOOAM_small.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">A Modular Arbitrary-Order Ocean-Atmosphere Model</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Modular arbitrary-order ocean-atmosphere model: MAOOAM -- Fortran implementation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>About</h2>
<p>(c) 2013-2020 Lesley De Cruz and Jonathan Demaeyer</p>
<p>See <a href="../../LICENSE.txt">LICENSE.txt</a> for license information.</p>
<p>This software is provided as supplementary material with:</p>
<ul>
<li>De Cruz, L., Demaeyer, J. and Vannitsem, S.: The Modular Arbitrary-Order Ocean-Atmosphere Model: MAOOAM v1.0, Geosci. Model Dev., 9, 2793-2808, <a href="http://dx.doi.org/10.5194/gmd-9-2793-2016">doi:10.5194/gmd-9-2793-2016</a>, 2016.</li>
</ul>
<p><b>Please cite this article if you use (a part of) this software for a publication.</b></p>
<p>The authors would appreciate it if you could also send a reprint of your paper to <a href="#" onclick="location.href='mai'+'lto:'+'les'+'le'+'y.d'+'ec'+'ruz'+'@m'+'ete'+'o.'+'be'; return false;">lesle<span style="display: none;">.nosp@m.</span>y.de<span style="display: none;">.nosp@m.</span>cruz@<span style="display: none;">.nosp@m.</span>mete<span style="display: none;">.nosp@m.</span>o.be</a>, <a href="#" onclick="location.href='mai'+'lto:'+'jon'+'at'+'han'+'.d'+'ema'+'ey'+'er@'+'me'+'teo'+'.b'+'e'; return false;">jonat<span style="display: none;">.nosp@m.</span>han.<span style="display: none;">.nosp@m.</span>demae<span style="display: none;">.nosp@m.</span>yer@<span style="display: none;">.nosp@m.</span>meteo<span style="display: none;">.nosp@m.</span>.be</a> and <a href="#" onclick="location.href='mai'+'lto:'+'svn'+'@m'+'ete'+'o.'+'be'; return false;">svn@m<span style="display: none;">.nosp@m.</span>eteo<span style="display: none;">.nosp@m.</span>.be</a>.</p>
<p>Consult the MAOOAM <a href="http://www.github.com/Climdyn/MAOOAM">code repository</a> for updates, and <a href="http://climdyn.meteo.be">our website</a> for additional resources.</p>
<p>A pdf version of this manual is available <a href="../latex/Reference_manual.pdf">here</a>.</p>
<hr/>
<h2>Installation</h2>
<p>The program can be installed with Makefile. We provide configuration files for two compilers : gfortran and ifort.</p>
<p>By default, gfortran is selected. To select one or the other, simply modify the Makefile accordingly or pass the COMPILER flag to <code>make</code>.</p>
<p>To install, unpack the archive in a folder or clone with git:</p>
<div class="fragment"><div class="line">git clone https://github.com/Climdyn/MAOOAM.git</div><div class="line">cd MAOOAM/fortran</div></div><!-- fragment --><p>and run:</p>
<div class="fragment"><div class="line">make</div></div><!-- fragment --><p>The command</p>
<div class="fragment"><div class="line">make clean</div></div><!-- fragment --><p> removes the compiled files.</p>
<p>For Windows users, a minimalistic GNU development environment (including gfortran and make) is available at <a href="http://www.mingw.org">www.mingw.org</a> .</p>
<hr/>
<h2>Description of the files</h2>
<p>The model tendencies are represented through a tensor class called AtmOcTensor (<a class="el" href="structaotensor__def_1_1atmoctensor.html" title="Class to hold the tensor  representation of the tendencies. ">aotensor_def::atmoctensor</a>) which includes all the coefficients. In the standard implementation using <a class="el" href="maooam_8f90_source.html">maooam.f90</a> , this tensor is computed once at the program initialization.</p>
<ul>
<li><a class="el" href="maooam_8f90_source.html">maooam.f90</a> : Main program.</li>
<li><a class="el" href="model__def_8f90_source.html">model_def.f90</a> : Main model class module.</li>
<li><a class="el" href="aotensor__def_8f90_source.html">aotensor_def.f90</a> : Tensor class AtmOcTensor module.</li>
<li><a class="el" href="inprod__analytic_8f90_source.html">inprod_analytic.f90</a> : Inner products class module.</li>
<li><a class="el" href="integrator__def_8f90_source.html">integrator_def.f90</a> : A module holding the model's integrator base class definition.</li>
<li><a class="el" href="rk2__integrator_8f90_source.html">rk2_integrator.f90</a> : A module which contains the Heun integrator class for the model equations.</li>
<li><a class="el" href="rk2__tl__integrator_8f90_source.html">rk2_tl_integrator.f90</a> : Heun Tangent Linear (TL) model integrator class module.</li>
<li><a class="el" href="rk2__ad__integrator_8f90_source.html">rk2_ad_integrator.f90</a> : Heun Adjoint (AD) model integrator class module.</li>
<li><a class="el" href="rk4__integrator_8f90_source.html">rk4_integrator.f90</a> : A module which contains the RK4 integrator class for the model equations.</li>
<li><a class="el" href="rk4__tl__integrator_8f90_source.html">rk4_tl_integrator.f90</a> : RK4 Tangent Linear (TL) model integrators module.</li>
<li><a class="el" href="rk4__ad__integrator_8f90_source.html">rk4_ad_integrator.f90</a> : Adjoint (AD) model integrators module.</li>
<li>Makefile : The Makefile.</li>
<li><a class="el" href="params_8f90_source.html">params.f90</a> : The model parameters classes module.</li>
<li><a class="el" href="tl__ad__tensor_8f90_source.html">tl_ad_tensor.f90</a> : Tangent Linear (TL) and Adjoint (AD) model tensors class definition module.</li>
<li><a class="el" href="test__tl__ad_8f90_source.html">test_tl_ad.f90</a> : Tests for the Tangent Linear (TL) and Adjoint (AD) model versions.</li>
<li>README.md : A read me file.</li>
<li>LICENSE.txt : The license text of the program.</li>
<li><a class="el" href="util_8f90_source.html">util.f90</a> : A module with various useful functions.</li>
<li><a class="el" href="tensor__def_8f90_source.html">tensor_def.f90</a> : Main tensor class utility module.</li>
<li><a class="el" href="stat_8f90_source.html">stat.f90</a> : A module implementing a statistics accumulator class.</li>
<li>params.nml : A namelist to specify the model parameters.</li>
<li>int_params.nml : A namelist to specify the integration parameters.</li>
<li>modeselection.nml : A namelist to specify which spectral decomposition will be used.</li>
</ul>
<hr/>
<h2>Usage</h2>
<p>The user first has to fill the params.nml and int_params.nml namelist files according to their needs. Indeed, model and integration parameters can be specified respectively in the params.nml and int_params.nml namelist files. Some examples related to already published article are available in the <a href="../../params/">params</a> folder.</p>
<p>The modeselection.nml namelist can then be filled :</p><ul>
<li>NBOC and NBATM specify the number of blocks that will be used in respectively the ocean and the atmosphere. Each block corresponds to a given x and y wavenumber.</li>
<li>The OMS and AMS arrays are integer arrays which specify which wavenumbers of the spectral decomposition will be used in respectively the ocean and the atmosphere. Their shapes are OMS(NBOC,2) and AMS(NBATM,2).</li>
<li>The first dimension specifies the number attributed by the user to the block and the second dimension specifies the x and the y wavenumbers.</li>
<li>The VDDG model is given as a default example. It is described in:<ul>
<li>Vannitsem, S., Demaeyer, J., De Cruz, L., and Ghil, M.: Low-frequency variability and heat transport in a loworder nonlinear coupled ocean-atmosphere model, Physica D: Nonlinear Phenomena, 309, 71-85, <a href="https://doi.org/10.1016/j.physd.2015.07.006">doi:10.1016/j.physd.2015.07.006</a>, 2015.</li>
</ul>
</li>
<li>Note that the variables of the model are numbered according to the chosen order of the blocks.</li>
</ul>
<p>Finally, the IC.nml file specifying the initial condition should be defined. To obtain an example of this configuration file corresponding to the model you have previously defined, simply delete the current IC.nml file (if it exists) and run the program : </p><pre class="fragment">./maooam
</pre><p>It will generate a new one and start with the 0 initial condition. If you want another initial condition, stop the program, fill the newly generated file and restart : </p><pre class="fragment">./maooam
</pre><p>It will generate two files :</p><ul>
<li>evol_field.dat : the recorded time evolution of the variables.</li>
<li>mean_field.dat : the mean field (the climatology)</li>
</ul>
<p>By default, the code uses the <a class="el" href="namespacerk2__integrator.html" title="Module containing the second-order Runge-Kutta (RK2) integration routines. ">rk2_integrator</a> class of integrator, which integrates the model with the <a href="https://en.wikipedia.org/wiki/Heun%27s_method">Heun algorithm</a>. However, by modifying the file <a class="el" href="maooam_8f90_source.html">maooam.f90</a>, it is possible to use the <a class="el" href="namespacerk4__integrator.html" title="Module containing the fourth-order Runge-Kutta (RK4) integration routines. ">rk4_integrator</a> class which integrates the model with the <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">fourth-order Runge-Kutta algorithm (RK4)</a>. It is also possible to write an user-defined integrator by subclassing the base class <a class="el" href="structintegrator__def_1_1integrator.html" title="Base class to be subclassed to create a new integrator. ">integrator_def::integrator</a>.</p>
<p>The tangent linear and adjoint models of MAOOAM are provided in the <a class="el" href="namespacetl__ad__tensor.html" title="Tangent Linear (TL) and Adjoint (AD) model versions of MAOOAM. Tensors definition module...">tl_ad_tensor</a>, with integrators provided in the <a class="el" href="namespacerk2__tl__integrator.html" title="Tangent Linear (TL) model versions of MAOOAM. Second-order Runge-Kutta (RK2) integrators module...">rk2_tl_integrator</a>, <a class="el" href="namespacerk2__ad__integrator.html" title="Adjoint (AD) model versions of MAOOAM. Second-order Runge-Kutta (RK2) integrators module...">rk2_ad_integrator</a>, <a class="el" href="namespacerk4__tl__integrator.html" title="Tangent Linear (TL) model versions of MAOOAM. Fourth-order Runge-Kutta (RK4) integrators module...">rk4_tl_integrator</a> and <a class="el" href="namespacerk4__ad__integrator.html" title="Adjoint (AD) model versions of MAOOAM. Fourth-order Runge-Kutta (RK4) integrators module...">rk4_ad_integrator</a> modules. It is documented <a href="./md_doc_tl_ad_doc.html">here</a>.</p>
<hr/>
<h2>Implementation notes</h2>
<p>As the system of differential equations is at most bilinear in \(y_j\) ( \(j=1..n\)), \(\boldsymbol{y}\) being the array of variables, it can be expressed as a tensor contraction :</p>
<p class="formulaDsp">
\[ \frac{d y_i}{dt} = \sum_{j,k=0}^{ndim} \, \mathcal{T}_{i,j,k} \, y_k \; y_j \]
</p>
<p>with \(y_0 = 1\).</p>
<p>The tensor aotensor_def::aotensor is the tensor \(\mathcal{T}\) that encodes the differential equations is composed so that:</p>
<ul>
<li>\(\mathcal{T}_{i,j,k}\) contains the contribution of \(dy_i/dt\) proportional to \( y_j \, y_k\).</li>
<li>Furthermore, \(y_0\) is always equal to 1, so that \(\mathcal{T}_{i,0,0}\) is the constant contribution to \(dy_i/dt\)</li>
<li>\(\mathcal{T}_{i,j,0} + \mathcal{T}_{i,0,j}\) is the contribution to \(dy_i/dt\) which is linear in \(y_j\).</li>
</ul>
<p>The tensor <a class="el" href="structaotensor__def_1_1atmoctensor.html" title="Class to hold the tensor  representation of the tendencies. ">aotensor_def::atmoctensor</a> is composed as an upper triangular matrix (in the last two coordinates), and its computation uses the inner products defined in a <a class="el" href="structinprod__analytic_1_1innerproducts.html" title="Global class for the inner products. Contains also the modes informations. ">inprod_analytic::innerproducts</a> class.</p>
<p>The implementation is made using Fortran classes that are linked together. It turns the model into an instanciated object that can be reused, allowing the usage of several different model versions in the same program. See the page <a class="el" href="structmodel__def_1_1model.html" title="Class to hold the components of a model version. ">model_def::model</a> for a sketch of how the various classes are linked together.</p>
<hr/>
<h2>Final Remarks</h2>
<p>The authors would like to thank Kris for help with the lua2fortran project. It has greatly reduced the amount of (error-prone) work.</p>
<p>No animals were harmed during the coding process. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 26 2020 17:41:24 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
