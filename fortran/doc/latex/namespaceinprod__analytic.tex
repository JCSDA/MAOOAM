\hypertarget{namespaceinprod__analytic}{}\section{inprod\+\_\+analytic Module Reference}
\label{namespaceinprod__analytic}\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}}


Inner products between the truncated set of basis functions for the ocean and atmosphere streamfunction fields.  


\subsection*{Data Types}
\begin{DoxyCompactItemize}
\item 
type \hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}
\begin{DoxyCompactList}\small\item\em Class holding the atmospheric inner products functions. \end{DoxyCompactList}\item 
type \hyperlink{structinprod__analytic_1_1atmosphericwavenumber}{atmosphericwavenumber}
\begin{DoxyCompactList}\small\item\em Atmospheric bloc specification object. \end{DoxyCompactList}\item 
type \hyperlink{structinprod__analytic_1_1innerproducts}{innerproducts}
\begin{DoxyCompactList}\small\item\em Global class for the inner products. Contains also the modes informations. \end{DoxyCompactList}\item 
type \hyperlink{structinprod__analytic_1_1oceanicwavenumber}{oceanicwavenumber}
\begin{DoxyCompactList}\small\item\em Oceanic bloc specification object. \end{DoxyCompactList}\item 
type \hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}
\begin{DoxyCompactList}\small\item\em Class holding the oceanic inner products functions. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a64153fea3801b0768d3b5122da23b324}{calculate\+\_\+a} (self, i, j)
\begin{DoxyCompactList}\small\item\em Eigenvalues of the Laplacian (atmospheric) \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a5608ef2b86882c7055455fbd785a8f84}{calculate\+\_\+b} (self, i, j, k)
\begin{DoxyCompactList}\small\item\em Streamfunction advection terms (atmospheric) \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_aa0b310b730d6df3d09a565a09aa62a22}{calculate\+\_\+c\+\_\+atm} (self, i, j)
\begin{DoxyCompactList}\small\item\em Beta term for the atmosphere. \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_ab270711bbfe233c1182dca363f80ec41}{calculate\+\_\+d} (self, i, j)
\begin{DoxyCompactList}\small\item\em Forcing of the ocean on the atmosphere. \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_ae90415e2fe9f94483e4b353afc11d245}{calculate\+\_\+g} (self, i, j, k)
\begin{DoxyCompactList}\small\item\em Temperature advection terms (atmospheric) \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a3ca3072c7041b05f960b841dbcc51979}{calculate\+\_\+s} (self, i, j)
\begin{DoxyCompactList}\small\item\em Forcing (thermal) of the ocean on the atmosphere. \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a25c4aee768622508f24ea32ce9258618}{calculate\+\_\+k} (self, i, j)
\begin{DoxyCompactList}\small\item\em Forcing of the atmosphere on the ocean. \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a04bacbacbd212ad46418336455c30fb4}{calculate\+\_\+m} (self, i, j)
\begin{DoxyCompactList}\small\item\em Forcing of the ocean fields on the ocean. \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a83197d7b47ce78f414762a1d8fe410bf}{calculate\+\_\+n} (self, i, j)
\begin{DoxyCompactList}\small\item\em Beta term for the ocean. \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_ad8d3f48abb40cd01056bbb15c4c52be6}{calculate\+\_\+o} (self, i, j, k)
\begin{DoxyCompactList}\small\item\em Temperature advection term (passive scalar) \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a4040642a04e9a16f23b51fcff998c513}{calculate\+\_\+c\+\_\+oc} (self, i, j, k)
\begin{DoxyCompactList}\small\item\em Streamfunction advection terms (oceanic) \end{DoxyCompactList}\item 
real(kind=8) function \hyperlink{namespaceinprod__analytic_a2d96b61d6e18b90638227c6f82042281}{calculate\+\_\+w} (self, i, j)
\begin{DoxyCompactList}\small\item\em Short-\/wave radiative forcing of the ocean. \end{DoxyCompactList}\item 
subroutine \hyperlink{namespaceinprod__analytic_ad2e5c28272f877bf96af8ee821004386}{init\+\_\+inner\+\_\+products} (inner\+\_\+products, model\+\_\+config)
\begin{DoxyCompactList}\small\item\em Initialization routine for the inner products functions. \end{DoxyCompactList}\item 
subroutine \hyperlink{namespaceinprod__analytic_a1319e98f839daff8d840469929c349fb}{delete\+\_\+inner\+\_\+products} (inner\+\_\+products)
\begin{DoxyCompactList}\small\item\em Routine to clean a inner products global object. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Inner products between the truncated set of basis functions for the ocean and atmosphere streamfunction fields. 

\begin{DoxyRemark}{Remarks}
These are partly calculated using the analytical expressions from Cehelsky, P., \& Tung, K. K. \+: Theories of multiple equilibria and weather regimes-\/A critical reexamination. Part II\+: Baroclinic two-\/layer models. Journal of the atmospheric sciences, 44(21), 3282-\/3303, 1987. 
\end{DoxyRemark}
\begin{DoxyCopyright}{Copyright}
2015-\/2020 Lesley De Cruz \& Jonathan Demaeyer. See L\+I\+C\+E\+N\+S\+E.\+txt for license information. 
\end{DoxyCopyright}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespaceinprod__analytic_a64153fea3801b0768d3b5122da23b324}\label{namespaceinprod__analytic_a64153fea3801b0768d3b5122da23b324}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+a@{calculate\+\_\+a}}
\index{calculate\+\_\+a@{calculate\+\_\+a}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+a()}{calculate\_a()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+a (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Eigenvalues of the Laplacian (atmospheric) 

$ a_{i,j} = (F_i, \nabla^2 F_j)$ . 

Definition at line 179 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
179     \textcolor{keywordtype}{CLASS}(atmosphereinnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
180     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
181     \textcolor{keywordtype}{TYPE}(atmosphericwavenumber) :: ti
182     
183     calculate\_a = 0.d0
184     \textcolor{keywordflow}{IF} (i==j) \textcolor{keywordflow}{THEN}
185       ti = self%inner\_products%awavenum(i)
186       calculate\_a = -(self%inner\_products%model\_config%physics%n**2) * ti%Nx**2 - ti%Ny**2
187 \textcolor{keywordflow}{    END IF}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a5608ef2b86882c7055455fbd785a8f84}\label{namespaceinprod__analytic_a5608ef2b86882c7055455fbd785a8f84}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+b@{calculate\+\_\+b}}
\index{calculate\+\_\+b@{calculate\+\_\+b}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+b()}{calculate\_b()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+b (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j,  }\item[{integer, intent(in)}]{k }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Streamfunction advection terms (atmospheric) 

$ b_{i,j,k} = (F_i, J(F_j, \nabla^2 F_k))$ . 

Definition at line 194 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
194     \textcolor{keywordtype}{CLASS}(atmosphereinnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
195     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j,k
196 
197     calculate\_b = self%a(k,k) * self%g(i,j,k)
198 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_aa0b310b730d6df3d09a565a09aa62a22}\label{namespaceinprod__analytic_aa0b310b730d6df3d09a565a09aa62a22}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+c\+\_\+atm@{calculate\+\_\+c\+\_\+atm}}
\index{calculate\+\_\+c\+\_\+atm@{calculate\+\_\+c\+\_\+atm}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+c\+\_\+atm()}{calculate\_c\_atm()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+c\+\_\+atm (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Beta term for the atmosphere. 

$ c_{i,j} = (F_i, \partial_x F_j)$ . 

Definition at line 205 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
205     \textcolor{keywordtype}{CLASS}(atmosphereinnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
206     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
207     \textcolor{keywordtype}{TYPE}(atmosphericwavenumber) :: ti, tj
208 
209     ti = self%inner\_products%awavenum(i)
210     tj = self%inner\_products%awavenum(j)
211     calculate\_c\_atm = 0.d0
212     \textcolor{keywordflow}{IF} ((ti%typ == \textcolor{stringliteral}{"K"}) .AND. (tj%typ == \textcolor{stringliteral}{"L"})) \textcolor{keywordflow}{THEN} 
213       calculate\_c\_atm = ti%M * delta(ti%M - tj%H) * delta(ti%P - tj%P)
214     \textcolor{keywordflow}{ELSE} \textcolor{keywordflow}{IF} ((ti%typ == \textcolor{stringliteral}{"L"}) .AND. (tj%typ == \textcolor{stringliteral}{"K"})) \textcolor{keywordflow}{THEN}
215       ti = self%inner\_products%awavenum(j)
216       tj = self%inner\_products%awavenum(i)
217       calculate\_c\_atm = - ti%M * delta(ti%M - tj%H) * delta(ti%P - tj%P)
218 \textcolor{keywordflow}{    END IF}
219     calculate\_c\_atm = self%inner\_products%model\_config%physics%n * calculate\_c\_atm
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a4040642a04e9a16f23b51fcff998c513}\label{namespaceinprod__analytic_a4040642a04e9a16f23b51fcff998c513}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+c\+\_\+oc@{calculate\+\_\+c\+\_\+oc}}
\index{calculate\+\_\+c\+\_\+oc@{calculate\+\_\+c\+\_\+oc}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+c\+\_\+oc()}{calculate\_c\_oc()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+c\+\_\+oc (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j,  }\item[{integer, intent(in)}]{k }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Streamfunction advection terms (oceanic) 

$ C_{i,j,k} = (\eta_i, J(\eta_j,\nabla^2 \eta_k))$ . 

Definition at line 438 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
438     \textcolor{keywordtype}{CLASS}(oceaninnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
439     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j,k
440 
441     calculate\_c\_oc = self%M(k,k) * self%O(i,j,k)
442 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_ab270711bbfe233c1182dca363f80ec41}\label{namespaceinprod__analytic_ab270711bbfe233c1182dca363f80ec41}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+d@{calculate\+\_\+d}}
\index{calculate\+\_\+d@{calculate\+\_\+d}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+d()}{calculate\_d()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+d (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Forcing of the ocean on the atmosphere. 

$ d_{i,j} = (F_i, \nabla^2 \eta_j)$ . 

Definition at line 226 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
226     \textcolor{keywordtype}{CLASS}(atmosphereinnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
227     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
228 
229     calculate\_d=self%s(i,j) * self%inner\_products%ocean%M(j,j)
230 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_ae90415e2fe9f94483e4b353afc11d245}\label{namespaceinprod__analytic_ae90415e2fe9f94483e4b353afc11d245}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+g@{calculate\+\_\+g}}
\index{calculate\+\_\+g@{calculate\+\_\+g}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+g()}{calculate\_g()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+g (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j,  }\item[{integer, intent(in)}]{k }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Temperature advection terms (atmospheric) 

$ g_{i,j,k} = (F_i, J(F_j, F_k))$ . 

Definition at line 237 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
237     \textcolor{keywordtype}{CLASS}(atmosphereinnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
238     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j,k
239     \textcolor{keywordtype}{TYPE}(atmosphericwavenumber) :: ti,tj,tk
240     \textcolor{keywordtype}{REAL(KIND=8)} :: val,vb1, vb2, vs1, vs2, vs3, vs4
241     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{DIMENSION(3)} :: a,b
242     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{DIMENSION(3,3)} :: w
243     \textcolor{keywordtype}{CHARACTER}, \textcolor{keywordtype}{DIMENSION(3)} :: s
244     \textcolor{keywordtype}{INTEGER} :: par
245 
246     ti = self%inner\_products%awavenum(i)
247     tj = self%inner\_products%awavenum(j)
248     tk = self%inner\_products%awavenum(k)
249 
250     a(1)=i
251     a(2)=j
252     a(3)=k
253 
254     val=0.d0
255 
256     \textcolor{keywordflow}{IF} ((ti%typ == \textcolor{stringliteral}{"L"}) .AND. (tj%typ == \textcolor{stringliteral}{"L"}) .AND. (tk%typ == \textcolor{stringliteral}{"L"})) \textcolor{keywordflow}{THEN}
257        
258       \textcolor{keyword}{CALL }piksrt(3,a,par)
259 
260       ti = self%inner\_products%awavenum(a(1))
261       tj = self%inner\_products%awavenum(a(2))
262       tk = self%inner\_products%awavenum(a(3))
263 
264       vs3 = s3(tj%P,tk%P,tj%H,tk%H)
265       vs4 = s4(tj%P,tk%P,tj%H,tk%H)
266       val = vs3 * ((delta(tk%H - tj%H - ti%H) - delta(tk%H &
267         &- tj%H + ti%H)) * delta(tk%P + tj%P - ti%P) +&
268         & delta(tk%H + tj%H - ti%H) * (delta(tk%P - tj%P&
269         & + ti%P) - delta(tk%P - tj%P - ti%P))) + vs4 *&
270         & ((delta(tk%H + tj%H - ti%H) * delta(tk%P - tj&
271         &%P - ti%P)) + (delta(tk%H - tj%H + ti%H) -&
272         & delta(tk%H - tj%H - ti%H)) * (delta(tk%P - tj&
273         &%P - ti%P) - delta(tk%P - tj%P + ti%P)))
274     \textcolor{keywordflow}{ELSE}
275 
276       s(1)=ti%typ
277       s(2)=tj%typ
278       s(3)=tk%typ
279 
280       w(1,:)=isin(\textcolor{stringliteral}{"A"},s)
281       w(2,:)=isin(\textcolor{stringliteral}{"K"},s)
282       w(3,:)=isin(\textcolor{stringliteral}{"L"},s)
283 
284       \textcolor{keywordflow}{IF} (any(w(1,:)/=0) .AND. any(w(2,:)/=0) .AND. any(w(3,:)/=0)) \textcolor{keywordflow}{THEN}
285         b=w(:,1)
286         ti = self%inner\_products%awavenum(a(b(1)))
287         tj = self%inner\_products%awavenum(a(b(2)))
288         tk = self%inner\_products%awavenum(a(b(3)))
289         \textcolor{keyword}{call }piksrt(3,b,par)
290         vb1 = b1(ti%P,tj%P,tk%P)
291         vb2 = b2(ti%P,tj%P,tk%P)
292         val = -2 * sqrt(2.) / self%inner\_products%model\_config%physics%pi * tj%M * delta(tj%M - tk%H) * 
      flambda(ti%P + tj%P + tk%P)
293         \textcolor{keywordflow}{IF} (val /= 0.d0) val = val * (vb1**2 / (vb1**2 - 1) - vb2**2 / (vb2**2 - 1))
294       \textcolor{keywordflow}{ELSEIF} ((w(2,2)/=0) .AND. (w(2,3)==0) .AND. any(w(3,:)/=0)) \textcolor{keywordflow}{THEN}
295         ti = self%inner\_products%awavenum(a(w(2,1)))
296         tj = self%inner\_products%awavenum(a(w(2,2)))
297         tk = self%inner\_products%awavenum(a(w(3,1)))
298         b(1)=w(2,1)
299         b(2)=w(2,2)
300         b(3)=w(3,1)
301         \textcolor{keyword}{call }piksrt(3,b,par)
302         vs1 = s1(tj%P,tk%P,tj%M,tk%H)
303         vs2 = s2(tj%P,tk%P,tj%M,tk%H)
304         val = vs1 * (delta(ti%M - tk%H - tj%M) * delta(ti%P -&
305           & tk%P + tj%P) - delta(ti%M- tk%H - tj%M) *&
306           & delta(ti%P + tk%P - tj%P) + (delta(tk%H - tj%M&
307           & + ti%M) + delta(tk%H - tj%M - ti%M)) *&
308           & delta(tk%P + tj%P - ti%P)) + vs2 * (delta(ti%M&
309           & - tk%H - tj%M) * delta(ti%P - tk%P - tj%P) +&
310           & (delta(tk%H - tj%M - ti%M) + delta(ti%M + tk%H&
311           & - tj%M)) * (delta(ti%P - tk%P + tj%P) -&
312           & delta(tk%P - tj%P + ti%P)))
313 \textcolor{keywordflow}{      ENDIF}
314 \textcolor{keywordflow}{    ENDIF}
315     calculate\_g=par*val*self%inner\_products%model\_config%physics%n
316  
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a25c4aee768622508f24ea32ce9258618}\label{namespaceinprod__analytic_a25c4aee768622508f24ea32ce9258618}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+k@{calculate\+\_\+k}}
\index{calculate\+\_\+k@{calculate\+\_\+k}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+k()}{calculate\_k()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+k (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Forcing of the atmosphere on the ocean. 

$ K_{i,j} = (\eta_i, \nabla^2 F_j)$ . 

Definition at line 357 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
357     \textcolor{keywordtype}{CLASS}(oceaninnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
358     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
359 
360     calculate\_k = self%inner\_products%atmos%s(j,i) * self%inner\_products%atmos%a(j,j)
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a04bacbacbd212ad46418336455c30fb4}\label{namespaceinprod__analytic_a04bacbacbd212ad46418336455c30fb4}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+m@{calculate\+\_\+m}}
\index{calculate\+\_\+m@{calculate\+\_\+m}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+m()}{calculate\_m()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+m (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Forcing of the ocean fields on the ocean. 

$ M_{i,j} = (eta_i, \nabla^2 \eta_j)$ . 

Definition at line 367 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
367     \textcolor{keywordtype}{CLASS}(oceaninnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
368     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
369     \textcolor{keywordtype}{TYPE}(oceanicwavenumber) :: di
370 
371     calculate\_m=0.d0
372     \textcolor{keywordflow}{IF} (i==j) \textcolor{keywordflow}{THEN}
373       di = self%inner\_products%owavenum(i)
374       calculate\_m = -(self%inner\_products%model\_config%physics%n**2) * di%Nx**2 - di%Ny**2
375 \textcolor{keywordflow}{    END IF}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a83197d7b47ce78f414762a1d8fe410bf}\label{namespaceinprod__analytic_a83197d7b47ce78f414762a1d8fe410bf}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+n@{calculate\+\_\+n}}
\index{calculate\+\_\+n@{calculate\+\_\+n}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+n()}{calculate\_n()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+n (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Beta term for the ocean. 

$ N_{i,j} = (\eta_i, \partial_x \eta_j) $. 

Definition at line 382 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
382     \textcolor{keywordtype}{CLASS}(oceaninnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
383     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
384     \textcolor{keywordtype}{TYPE}(oceanicwavenumber) :: di,dj
385     \textcolor{keywordtype}{REAL(KIND=8)} :: val
386 
387     di = self%inner\_products%owavenum(i)
388     dj = self%inner\_products%owavenum(j)
389     calculate\_n = 0.d0
390     \textcolor{keywordflow}{IF} (dj%H/=di%H) \textcolor{keywordflow}{THEN}
391       val = delta(di%P - dj%P) * flambda(di%H + dj%H)
392       calculate\_n = val * (-2) * dj%H * di%H * self%inner\_products%model\_config%physics%n
393       calculate\_n = calculate\_n / ((dj%H**2 - di%H**2) * self%inner\_products%model\_config%physics%pi)
394 \textcolor{keywordflow}{    ENDIF}
395         
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_ad8d3f48abb40cd01056bbb15c4c52be6}\label{namespaceinprod__analytic_ad8d3f48abb40cd01056bbb15c4c52be6}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+o@{calculate\+\_\+o}}
\index{calculate\+\_\+o@{calculate\+\_\+o}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+o()}{calculate\_o()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+o (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j,  }\item[{integer, intent(in)}]{k }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Temperature advection term (passive scalar) 

$ O_{i,j,k} = (\eta_i, J(\eta_j, \eta_k))$ . 

Definition at line 402 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
402     \textcolor{keywordtype}{CLASS}(oceaninnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
403     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j,k
404     \textcolor{keywordtype}{TYPE}(oceanicwavenumber) :: di,dj,dk
405     \textcolor{keywordtype}{REAL(KIND=8)} :: vs3,vs4,val
406     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{DIMENSION(3)} :: a
407     \textcolor{keywordtype}{INTEGER} :: par
408 
409     val=0.d0
410 
411     a(1)=i
412     a(2)=j
413     a(3)=k
414 
415     \textcolor{keyword}{CALL }piksrt(3,a,par)
416 
417     di = self%inner\_products%owavenum(a(1))
418     dj = self%inner\_products%owavenum(a(2))
419     dk = self%inner\_products%owavenum(a(3))
420 
421     vs3 = s3(dj%P,dk%P,dj%H,dk%H)
422     vs4 = s4(dj%P,dk%P,dj%H,dk%H)
423     val = vs3*((delta(dk%H - dj%H - di%H) - delta(dk%H - dj&
424       &%H + di%H)) * delta(dk%P + dj%P - di%P) + delta(dk&
425       &%H + dj%H - di%H) * (delta(dk%P - dj%P + di%P) -&
426       & delta(dk%P - dj%P - di%P))) + vs4 * ((delta(dk%H &
427       &+ dj%H - di%H) * delta(dk%P - dj%P - di%P)) +&
428       & (delta(dk%H - dj%H + di%H) - delta(dk%H - dj%H -&
429       & di%H)) * (delta(dk%P - dj%P - di%P) - delta(dk%P &
430       &- dj%P + di%P)))
431     calculate\_o = par * val * self%inner\_products%model\_config%physics%n / 2
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a3ca3072c7041b05f960b841dbcc51979}\label{namespaceinprod__analytic_a3ca3072c7041b05f960b841dbcc51979}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+s@{calculate\+\_\+s}}
\index{calculate\+\_\+s@{calculate\+\_\+s}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+s()}{calculate\_s()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+s (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1atmosphereinnerproducts}{atmosphereinnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Forcing (thermal) of the ocean on the atmosphere. 

$ s_{i,j} = (F_i, \eta_j)$ . 

Definition at line 323 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
323     \textcolor{keywordtype}{CLASS}(atmosphereinnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
324     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
325     \textcolor{keywordtype}{TYPE}(atmosphericwavenumber) :: ti
326     \textcolor{keywordtype}{TYPE}(oceanicwavenumber) :: dj
327     \textcolor{keywordtype}{REAL(KIND=8)} :: val
328     
329     ti = self%inner\_products%awavenum(i)
330     dj = self%inner\_products%owavenum(j)
331     val=0.d0
332     \textcolor{keywordflow}{IF} (ti%typ == \textcolor{stringliteral}{"A"}) \textcolor{keywordflow}{THEN}
333       val = flambda(dj%H) * flambda(dj%P + ti%P)
334       \textcolor{keywordflow}{IF} (val /= 0.d0) \textcolor{keywordflow}{THEN}
335         val = val*8*sqrt(2.)*dj%P/(self%inner\_products%model\_config%physics%pi**2 * (dj%P**2 - ti%P**2) * 
      dj%H)
336 \textcolor{keywordflow}{      END IF}
337     \textcolor{keywordflow}{ELSEIF} (ti%typ == \textcolor{stringliteral}{"K"}) \textcolor{keywordflow}{THEN}
338       val = flambda(2 * ti%M + dj%H) * delta(dj%P - ti%P)
339       \textcolor{keywordflow}{IF} (val /= 0.d0) \textcolor{keywordflow}{THEN}
340         val = val*4*dj%H/(self%inner\_products%model\_config%physics%pi * (-4 * ti%M**2 + dj%H**2))
341 \textcolor{keywordflow}{      END IF}
342     \textcolor{keywordflow}{ELSEIF} (ti%typ == \textcolor{stringliteral}{"L"}) \textcolor{keywordflow}{THEN}
343       val = delta(dj%P - ti%P) * delta(2 * ti%H - dj%H)
344 \textcolor{keywordflow}{    END IF}
345     calculate\_s=val
346     
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a2d96b61d6e18b90638227c6f82042281}\label{namespaceinprod__analytic_a2d96b61d6e18b90638227c6f82042281}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!calculate\+\_\+w@{calculate\+\_\+w}}
\index{calculate\+\_\+w@{calculate\+\_\+w}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{calculate\+\_\+w()}{calculate\_w()}}
{\footnotesize\ttfamily real(kind=8) function inprod\+\_\+analytic\+::calculate\+\_\+w (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1oceaninnerproducts}{oceaninnerproducts}), intent(in)}]{self,  }\item[{integer, intent(in)}]{i,  }\item[{integer, intent(in)}]{j }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Short-\/wave radiative forcing of the ocean. 

$ W_{i,j} = (\eta_i, F_j)$ . 

Definition at line 449 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
449     \textcolor{keywordtype}{CLASS}(oceaninnerproducts), \textcolor{keywordtype}{INTENT(IN)} :: self
450     \textcolor{keywordtype}{INTEGER}, \textcolor{keywordtype}{INTENT(IN)} :: i,j
451     
452     calculate\_w = self%inner\_products%atmos%s(j,i)
453 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_a1319e98f839daff8d840469929c349fb}\label{namespaceinprod__analytic_a1319e98f839daff8d840469929c349fb}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!delete\+\_\+inner\+\_\+products@{delete\+\_\+inner\+\_\+products}}
\index{delete\+\_\+inner\+\_\+products@{delete\+\_\+inner\+\_\+products}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{delete\+\_\+inner\+\_\+products()}{delete\_inner\_products()}}
{\footnotesize\ttfamily subroutine inprod\+\_\+analytic\+::delete\+\_\+inner\+\_\+products (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1innerproducts}{innerproducts}), intent(inout), target}]{inner\+\_\+products }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Routine to clean a inner products global object. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em inner\+\_\+products} & Inner products global object to initialize \\
\hline
\end{DoxyParams}


Definition at line 558 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
558     \textcolor{keywordtype}{CLASS}(innerproducts), \textcolor{keywordtype}{INTENT(INOUT)}, \textcolor{keywordtype}{TARGET} :: inner\_products
559 
560     \textcolor{keywordflow}{IF} (\textcolor{keyword}{allocated}(inner\_products%owavenum)) \textcolor{keyword}{DEALLOCATE}(inner\_products%owavenum)
561     \textcolor{keywordflow}{IF} (\textcolor{keyword}{allocated}(inner\_products%awavenum)) \textcolor{keyword}{DEALLOCATE}(inner\_products%awavenum)
562 
563     inner\_products%initialized = .false.
564 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceinprod__analytic_ad2e5c28272f877bf96af8ee821004386}\label{namespaceinprod__analytic_ad2e5c28272f877bf96af8ee821004386}} 
\index{inprod\+\_\+analytic@{inprod\+\_\+analytic}!init\+\_\+inner\+\_\+products@{init\+\_\+inner\+\_\+products}}
\index{init\+\_\+inner\+\_\+products@{init\+\_\+inner\+\_\+products}!inprod\+\_\+analytic@{inprod\+\_\+analytic}}
\subsubsection{\texorpdfstring{init\+\_\+inner\+\_\+products()}{init\_inner\_products()}}
{\footnotesize\ttfamily subroutine inprod\+\_\+analytic\+::init\+\_\+inner\+\_\+products (\begin{DoxyParamCaption}\item[{class(\hyperlink{structinprod__analytic_1_1innerproducts}{innerproducts}), intent(inout), target}]{inner\+\_\+products,  }\item[{class(\hyperlink{structparams_1_1modelconfiguration}{modelconfiguration}), intent(in), target}]{model\+\_\+config }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Initialization routine for the inner products functions. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em inner\+\_\+products} & Inner products global object to initialize \\
\hline
\mbox{\tt in}  & {\em model\+\_\+config} & Global model configuration object to initialize the inner products with \\
\hline
\end{DoxyParams}


Definition at line 466 of file inprod\+\_\+analytic.\+f90.


\begin{DoxyCode}
466     \textcolor{keywordtype}{CLASS}(innerproducts), \textcolor{keywordtype}{INTENT(INOUT)}, \textcolor{keywordtype}{TARGET} :: inner\_products
467     \textcolor{keywordtype}{CLASS}(modelconfiguration), \textcolor{keywordtype}{INTENT(IN)}, \textcolor{keywordtype}{TARGET} :: model\_config
468 
469     \textcolor{keywordtype}{TYPE}(innerproducts), \textcolor{keywordtype}{POINTER} :: ips
470 
471     \textcolor{keywordtype}{INTEGER} :: i,j
472     \textcolor{keywordtype}{INTEGER} :: allocstat
473 
474     ips => inner\_products
475 
476     \textcolor{keywordflow}{IF} (.NOT.model\_config%initialized) \textcolor{keywordflow}{THEN}
477       print*, \textcolor{stringliteral}{"Warning: Model configuration not initialized."}
478       print*, \textcolor{stringliteral}{"Aborting inner products initialization."}
479       \textcolor{keywordflow}{RETURN}
480 \textcolor{keywordflow}{    END IF}
481 
482     \textcolor{comment}{! Definition of the types and wave numbers tables}
483 
484     \textcolor{keywordflow}{IF} (\textcolor{keyword}{allocated}(ips%owavenum)) \textcolor{keyword}{DEALLOCATE}(ips%owavenum)
485     \textcolor{keyword}{ALLOCATE}(ips%owavenum(model\_config%modes%noc), \hyperlink{namespacestat}{stat}=allocstat)
486     \textcolor{keywordflow}{IF} (allocstat /= 0) \textcolor{keywordflow}{THEN}
487       print*, \textcolor{stringliteral}{"*** init\_inner\_products: Problem with allocation! ***"}
488       stop \textcolor{stringliteral}{"Exiting ..."}
489 \textcolor{keywordflow}{    END IF}
490 
491 
492     \textcolor{keywordflow}{IF} (\textcolor{keyword}{allocated}(ips%awavenum)) \textcolor{keyword}{DEALLOCATE}(ips%awavenum)
493     \textcolor{keyword}{ALLOCATE}(ips%awavenum(model\_config%modes%natm), \hyperlink{namespacestat}{stat}=allocstat)
494     \textcolor{keywordflow}{IF} (allocstat /= 0) \textcolor{keywordflow}{THEN}
495       print*, \textcolor{stringliteral}{"*** init\_inner\_products: Problem with allocation! ***"}
496       stop \textcolor{stringliteral}{"Exiting ..."}
497 \textcolor{keywordflow}{    END IF}
498 
499     j=0
500     \textcolor{keywordflow}{DO} i=1,model\_config%modes%nbatm
501       \textcolor{keywordflow}{IF} (model\_config%modes%ams(i,1)==1) \textcolor{keywordflow}{THEN}
502         ips%awavenum(j+1)%typ=\textcolor{stringliteral}{'A'}
503         ips%awavenum(j+2)%typ=\textcolor{stringliteral}{'K'}
504         ips%awavenum(j+3)%typ=\textcolor{stringliteral}{'L'}
505 
506         ips%awavenum(j+1)%P=model\_config%modes%ams(i,2)
507         ips%awavenum(j+2)%M=model\_config%modes%ams(i,1)
508         ips%awavenum(j+2)%P=model\_config%modes%ams(i,2)
509         ips%awavenum(j+3)%H=model\_config%modes%ams(i,1)
510         ips%awavenum(j+3)%P=model\_config%modes%ams(i,2)
511 
512         ips%awavenum(j+1)%Ny=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,2))
513         ips%awavenum(j+2)%Nx=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,1))
514         ips%awavenum(j+2)%Ny=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,2))
515         ips%awavenum(j+3)%Nx=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,1))
516         ips%awavenum(j+3)%Ny=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,2))
517 
518         j=j+3
519       \textcolor{keywordflow}{ELSE}
520         ips%awavenum(j+1)%typ=\textcolor{stringliteral}{'K'}
521         ips%awavenum(j+2)%typ=\textcolor{stringliteral}{'L'}
522 
523         ips%awavenum(j+1)%M=model\_config%modes%ams(i,1)
524         ips%awavenum(j+1)%P=model\_config%modes%ams(i,2)
525         ips%awavenum(j+2)%H=model\_config%modes%ams(i,1)
526         ips%awavenum(j+2)%P=model\_config%modes%ams(i,2)
527 
528         ips%awavenum(j+1)%Nx=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,1))
529         ips%awavenum(j+1)%Ny=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,2))
530         ips%awavenum(j+2)%Nx=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,1))
531         ips%awavenum(j+2)%Ny=\textcolor{keywordtype}{REAL}(model\_config%modes%ams(i,2))
532 
533         j=j+2
534 
535 \textcolor{keywordflow}{      ENDIF}
536 \textcolor{keywordflow}{    ENDDO}
537 
538     \textcolor{keywordflow}{DO} i=1,model\_config%modes%noc
539       ips%owavenum(i)%H=model\_config%modes%oms(i,1)
540       ips%owavenum(i)%P=model\_config%modes%oms(i,2)
541 
542       ips%owavenum(i)%Nx=model\_config%modes%oms(i,1)/2.d0
543       ips%owavenum(i)%Ny=model\_config%modes%oms(i,2)
544 
545 \textcolor{keywordflow}{    ENDDO}
546 
547     inner\_products%model\_config => model\_config
548     inner\_products%atmos%inner\_products => inner\_products
549     inner\_products%ocean%inner\_products => inner\_products
550 
551     inner\_products%initialized = .true.
552 
\end{DoxyCode}
